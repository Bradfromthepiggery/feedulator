"use strict";function FeedNewConfig(e){e.state("feed-new",{url:"/feeds/new",views:{main:{controller:"FeedNewCtrl",templateUrl:"app/feed/feed-new.tpl.min.html"}},data:{pageTitle:"Create New Feed"}})}function uiSelectDirective(){return function(e,t,l){e.$watch("formResult.compData",function(){$("#select"+l.uiSelect).select2({openOnEnter:!1,maximumSelectionSize:1}).on("change",function(t){t.added?e.$apply("updateComp("+l.uiSelect+", '"+t.val+"')"):t.removed&&e.$apply("nullifyComp("+l.uiSelect+")")})})}}function FeedNewController(e,t,l,o,i,a,n,r,u){e.addNewComp=n.partial(a.addNewComp,e),e.calculate=n.partial(a.calculate,e),e.nullifyComp=n.partial(a.nullifyComp,e),e.optFeed=n.partial(a.optFeed,e),e.removeComp=n.partial(a.removeComp,e),e.resetComps=n.partial(a.resetComps,e),e.updateComp=n.partial(a.updateComp,e),e.isLoggedIn=n.partial(i.isLoggedIn,e),e.isPrivilegedUser=n.partial(i.isPrivilegedUser,e),e.initRadio=u.initRadio,e.makeSticky=u.makeSticky,e.isUndefined=angular.isUndefined,o.getAllComponents(e).then(function(){e.compData=n.sortBy(e.compData,function(e){return e.name}),localStorage.getItem("formResult")?(e.formResult=JSON.parse(localStorage.getItem("formResult")),l(function(){e.formResult.compData.forEach(function(e,t){$("#select"+t).select2("val",e._id)}),e.calculate()})):e.formResult={creationDate:new Date,compData:[{_id:null,name:null,value:100,cost:0}],isPrivate:!0}}),o.getAllAnimals(e),e.submit=function(){e.formResult._id=r.slugify(e.formResult.name),e.formResult.owner=e.profile.user_id,e.isPrivilegedUser()||(e.formResult.isPrivate=!0);var l={};l[e.formResult._id]=e.formResult,o.addFeed(l).then(function(){localStorage.removeItem("formResult"),Messenger().post("Saved feed '"+e.formResult.name+"'"),t.go("feed-list")})},e.$watch("formResult",function(e){e&&localStorage.setItem("formResult",JSON.stringify(e))},!0),l(function(){$("#select0").select2("focus")})}angular.module("app.feed-new",["app.common-api","app.common-auth","app.common-ui","app.feed-service","ngLodash","slugifier","ui.router"]).config(FeedNewConfig).directive("uiSelect",uiSelectDirective).controller("FeedNewCtrl",FeedNewController),FeedNewConfig.$inject=["$stateProvider"],FeedNewController.$inject=["$scope","$state","$timeout","APIUtil","AuthUtil","FeedUtil","lodash","Slug","UIUtil"];