"use strict";function LoginConfig(e,o,t,n){t.init({domain:"feedulator.auth0.com",clientID:"ZlO45vSlQVp1r4EyFMaOKLiUrScgmzdW",loginState:"login"}),n.tokenGetter=["$http","aiStorage","auth","jwtHelper",function(e,o,t,n){var i=o.get("idToken"),r=o.get("refreshToken");return i?n.isTokenExpired(i)?t.refreshIdToken(r):i:void 0}],e.interceptors.push("jwtInterceptor")}function LoginController(e,o,t,n,i,r){var l=function(l,a,s,c,f){n.set("profile",l),n.set("idToken",a),n.set("refreshToken",f),e.profile=r.profile,t.is("feed-list")?i.getAllFeeds(o.$$nextSibling):t.is("component-list")?i.getAllComponents(o.$$nextSibling):t.is("animal-list")&&i.getAllAnimals(o.$$nextSibling)},a=function(){};o.signIn=function(){r.signin({authParams:{popup:!0,connection:"google-oauth2",scope:"openid name email offline_access"},socialBigButtons:!0,icon:"./app/assets/pig.svg"},l,a)},o.signOut=function(){r.signout(),"profile"in e&&delete e.profile,n.remove("profile"),n.remove("idToken"),n.remove("refreshToken"),t.reload()}}function Authenticator(e,o,t,n){var i=e;i.$on("$locationChangeStart",function(){if(!t.isAuthenticated){var e=o.get("idToken"),r=o.get("profile"),l=o.get("refreshToken");if(e)if(n.isTokenExpired(e)){if(l)return t.refreshIdToken(l).then(function(e){o.set("idToken",e),t.authenticate(r,e),t.profilePromise.then(function(){i.profile=t.profile})})}else t.authenticate(r,e),t.profilePromise.then(function(){i.profile=t.profile})}})}angular.module("app.common-login",["angular-jwt","angular-storage","app.common-api","auth0","ui.router"]).config(LoginConfig).controller("LoginCtrl",LoginController).run(Authenticator),LoginConfig.$inject=["$httpProvider","$stateProvider","authProvider","jwtInterceptorProvider"],LoginController.$inject=["$rootScope","$scope","$state","aiStorage","APIUtil","auth"],Authenticator.$inject=["$rootScope","aiStorage","auth","jwtHelper"];